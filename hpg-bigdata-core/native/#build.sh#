#!/bin/bash

echo
echo "Building library avro-c-1.7.7"
cd third-party/avro-c-1.7.7/build/
make

cd ../../..
echo
echo "Building library htslib"
cd third-party/htslib
make

cd ../..
echo
echo "Building library samtools"
cd third-party/samtools
make HTSDIR=../htslib

cd ../..
echo
echo "Building dynamic library libhpgbigdata.so"
export LD_LIBRARY_PATH=third-party/avro-c-1.7.7/build/src/:third-party/htslib/
gcc -O3 -std=gnu99 ./jni/bam2avro.c -shared -fPIC -o ./jni/libhpgbigdata.so -I third-party/avro-c-1.7.7/src/ -I third-party/ -I third-party/htslib/ -L third-party/avro-c-1.7.7/build/src/ -L third-party/htslib/ -lhts -lavro -lpthread